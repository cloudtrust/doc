
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Sentry integration Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-richquotes/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="storage.html" />
    
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    Keycloak Development
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="1.2.1" data-path="sentry.html">
            
                <a href="sentry.html">
            
                    
                    Sentry integration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="storage.html">
            
                <a href="storage.html">
            
                    
                    Storage
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="protocol.html">
            
                <a href="protocol.html">
            
                    
                    Protocol
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    Deployment
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../chapter-deploy/Introduction.html">
            
                <a href="../chapter-deploy/Introduction.html">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../chapter-deploy/Docker.html">
            
                <a href="../chapter-deploy/Docker.html">
            
                    
                    Docker
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../chapter-deploy/Kubernetes.html">
            
                <a href="../chapter-deploy/Kubernetes.html">
            
                    
                    Kubernetes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../chapter-deploy/Systemd_In_Kubernetes.html">
            
                <a href="../chapter-deploy/Systemd_In_Kubernetes.html">
            
                    
                    Systemd In Kubernetes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="../chapter-deploy/Ansible.html">
            
                <a href="../chapter-deploy/Ansible.html">
            
                    
                    Ansible
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="../chapter-deploy/Configs.html">
            
                <a href="../chapter-deploy/Configs.html">
            
                    
                    Configurations
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7" data-path="../chapter-deploy/Telepresence.html">
            
                <a href="../chapter-deploy/Telepresence.html">
            
                    
                    Telepresence
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    Go Development
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../chapter-godevel/guideline.html">
            
                <a href="../chapter-godevel/guideline.html">
            
                    
                    Guidelines
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../chapter-godevel/structure.html">
            
                <a href="../chapter-godevel/structure.html">
            
                    
                    Repository Structure
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../chapter-godevel/testing.html">
            
                <a href="../chapter-godevel/testing.html">
            
                    
                    Testing with mocks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../chapter-godevel/logging.html">
            
                <a href="../chapter-godevel/logging.html">
            
                    
                    Logging
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../chapter-godevel/instrumenting.html">
            
                <a href="../chapter-godevel/instrumenting.html">
            
                    
                    Instrumenting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../chapter-godevel/tracing.html">
            
                <a href="../chapter-godevel/tracing.html">
            
                    
                    Tracing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="../chapter-godevel/tracking.html">
            
                <a href="../chapter-godevel/tracking.html">
            
                    
                    Tracking
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8" data-path="../chapter-godevel/health_route.html">
            
                <a href="../chapter-godevel/health_route.html">
            
                    
                    Health routes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.9" data-path="../chapter-godevel/debugging.html">
            
                <a href="../chapter-godevel/debugging.html">
            
                    
                    Debugging
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.10" data-path="../chapter-godevel/middleware.html">
            
                <a href="../chapter-godevel/middleware.html">
            
                    
                    Middlewares
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Sentry integration</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="keycloak-sentry-integration">Keycloak Sentry integration</h1>
<p>Sentry is an open source error traking software that publishes errors and logs to a network server. It&apos;s <a href="https://sentry.io/welcome/" target="_blank">website</a> states that one should &quot;Stop hoping that users will report errors&quot;. </p>
<p>Sentry allows for an integration with a large number of platforms, including Java, the language used in Keycloak, Their <a href="https://docs.sentry.io/clients/java/usage/" target="_blank">usage documentation</a> states that while it is possible to use Sentry manually, it is highly recommended to use one of the provided integrations. These integrations are basically common frameworks like Android of Spring, or popular logging engines such as log4j, Logback or JUL.</p>
<h2 id="implementation-in-sentry">Implementation in Sentry</h2>
<p>The installation of Sentry is beyond the scope of this document. But once it is installaled and correctly set up, simply:</p>
<ol>
<li>Create a new project</li>
<li>Select java from choice of framework, and select a project name (for example keycloak)</li>
<li>Go to your new project and open the project settings</li>
<li>Go to the <strong>Client Keys (DSN)</strong> section.</li>
<li>Note the DSN, This value will later have to be entered in keycloak&apos;s configuration.</li>
</ol>
<h2 id="implementation-in-keycloak">Implementation in Keycloak</h2>
<p>Of the loggers supported by Sentry, Keycloak supports, via jboss, log4j, log4j2 and JUL, as seen in <code>org.jboss.logging</code>, but by defaut log4j seems to be used. The <a href="https://docs.sentry.io/clients/java/modules/log4j/" target="_blank">Sentry documentation for log4j</a> states that a specific appender, <code>io.sentry.log4j.SentryAppender</code> must be used to send the information to Sentry.</p>
<p>In Keycloak this basically means:</p>
<ul>
<li>Adding the sentry and sentry-log4j libraries to Keycloak modules. Any loaded module can be used, including one specifically for Sentry (in which case do not forget to add the sentry module to the <code>layers.conf</code>).</li>
<li>Adding the appender to the standalone.xml (or configuration xml used).</li>
<li>Adding the Sentry DSN (basically the address of the Sentry server) to the same configuration file as a Java system property. There are other methods to do this (such as using a system environment, see <a href="https://docs.sentry.io/clients/java/config/" target="_blank">relevent documentation</a>), but the system property is the best for Keycloak,</li>
</ul>
<p>The directory structure is the following, where the base directory is the base directory of the module (in our case <code>&lt;keycloak root&gt;/modules/system/layers/sentry</code>):</p>
<pre><code>.
`-- io
    `-- sentry
        |-- log4j
        |   `-- main
        |       |-- module.xml
        |       `-- sentry-log4j-1.6.3.jar
        `-- main
            |-- module.xml
            `-- sentry-1.6.3.jar
</code></pre><p>The module.xml for the base sentry jar is as follows:</p>
<pre><code class="lang-xml"><span class="php"><span class="hljs-meta">&lt;?</span>xml version=<span class="hljs-string">&quot;1.0&quot;</span> <span class="hljs-meta">?&gt;</span></span>
<span class="hljs-tag">&lt;<span class="hljs-name">module</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;urn:jboss:module:1.1&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;io.sentry&quot;</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">resources</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">resource-root</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;sentry-1.6.3.jar&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">resources</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">module</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;com.fasterxml.jackson.core.jackson-core&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">module</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;org.slf4j&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">module</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;javax.api&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span>
</code></pre>
<p>And for the sentry-log4j;</p>
<pre><code class="lang-xml"><span class="php"><span class="hljs-meta">&lt;?</span>xml version=<span class="hljs-string">&quot;1.0&quot;</span> <span class="hljs-meta">?&gt;</span></span>
<span class="hljs-tag">&lt;<span class="hljs-name">module</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;urn:jboss:module:1.1&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;io.sentry.log4j&quot;</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">resources</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">resource-root</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;sentry-log4j-1.6.3.jar&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">resources</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">module</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;io.sentry&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">module</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;org.apache.log4j&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span>
</code></pre>
<p>The rest of the configuration can be done by running the following three lines in a connected jboss-cli, all three of which simply modify the configuration xml (standalone.xml in our case).</p>
<p>To set the defintion for the SentryAppender:</p>
<pre><code>/subsystem=logging/custom-handler=sentry:add(name=sentry,class=io.sentry.log4j.SentryAppender,module=io.sentry.log4j,enabled=true,formatter=PATTERN,level=WARN)
</code></pre><p>This adds the following lines to the configuration</p>
<pre><code class="lang-xml">...
    <span class="hljs-tag">&lt;<span class="hljs-name">profile</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">subsystem</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;urn:jboss:domain:logging:3.0&quot;</span>&gt;</span>
        ...
        <span class="hljs-tag">&lt;<span class="hljs-name">custom-handler</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;sentry&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;io.sentry.log4j.SentryAppender&quot;</span> <span class="hljs-attr">module</span>=<span class="hljs-string">&quot;io.sentry.log4j&quot;</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">level</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;WARN&quot;</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">formatter</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">pattern-formatter</span> <span class="hljs-attr">pattern</span>=<span class="hljs-string">&quot;PATTERN&quot;</span>/&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">formatter</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">custom-handler</span>&gt;</span>
            ...
</code></pre>
<p>To add the SentryAppender to the root logger:</p>
<pre><code>/subsystem=logging/root-logger=ROOT:add-handler(name=sentry)
</code></pre><p>This adds the following lines to the configuration</p>
<pre><code class="lang-xml">...
            <span class="hljs-tag">&lt;<span class="hljs-name">root-logger</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">level</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;INFO&quot;</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">handlers</span>&gt;</span>
                    ...
                    <span class="hljs-tag">&lt;<span class="hljs-name">handler</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;sentry&quot;</span>/&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">handlers</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">root-logger</span>&gt;</span>
            ...
</code></pre>
<p>To add the DSN to as a system property:</p>
<pre><code>/system-property=sentry.dsn:add(&lt;DSN value&gt;)
</code></pre><p>This adds the following lines to the configuration</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">server</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;urn:jboss:domain:5.0&quot;</span>&gt;</span>
...
    <span class="hljs-tag">&lt;<span class="hljs-name">system-properties</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;sentry.dsn&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;replace with DSN Value&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">system-properties</span>&gt;</span>
    ...
</code></pre>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                
                <a href="storage.html" class="navigation navigation-next navigation-unique" aria-label="Next page: Storage">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Sentry integration","level":"1.2.1","depth":2,"next":{"title":"Storage","level":"1.2.2","depth":2,"path":"chapter-keycloak/storage.md","ref":"chapter-keycloak/storage.md","articles":[]},"previous":{"title":"Keycloak Development","level":"1.2","depth":1,"ref":"","articles":[{"title":"Sentry integration","level":"1.2.1","depth":2,"path":"chapter-keycloak/sentry.md","ref":"chapter-keycloak/sentry.md","articles":[]},{"title":"Storage","level":"1.2.2","depth":2,"path":"chapter-keycloak/storage.md","ref":"chapter-keycloak/storage.md","articles":[]},{"title":"Protocol","level":"1.2.3","depth":2,"path":"chapter-keycloak/protocol.md","ref":"chapter-keycloak/protocol.md","articles":[]}]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["richquotes"],"pluginsConfig":{"richquotes":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"chapter-keycloak/sentry.md","mtime":"2018-02-01T14:49:32.562Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-04-03T13:03:13.889Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

