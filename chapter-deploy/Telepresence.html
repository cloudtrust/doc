
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Telepresence Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-richquotes/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    
    <link rel="prev" href="Configs.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    Keycloak Development
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../chapter-keycloak/sentry.html">
            
                <a href="../chapter-keycloak/sentry.html">
            
                    
                    Sentry integration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../chapter-keycloak/storage.html">
            
                <a href="../chapter-keycloak/storage.html">
            
                    
                    Storage
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../chapter-keycloak/protocol.html">
            
                <a href="../chapter-keycloak/protocol.html">
            
                    
                    Protocol
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    Deployment
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="Introduction.html">
            
                <a href="Introduction.html">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="Docker.html">
            
                <a href="Docker.html">
            
                    
                    Docker
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="Kubernetes.html">
            
                <a href="Kubernetes.html">
            
                    
                    Kubernetes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="Systemd_In_Kubernetes.html">
            
                <a href="Systemd_In_Kubernetes.html">
            
                    
                    Systemd In Kubernetes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="Ansible.html">
            
                <a href="Ansible.html">
            
                    
                    Ansible
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="Configs.html">
            
                <a href="Configs.html">
            
                    
                    Configurations
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.3.7" data-path="Telepresence.html">
            
                <a href="Telepresence.html">
            
                    
                    Telepresence
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    Go Development
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../chapter-godevel/guideline.html">
            
                <a href="../chapter-godevel/guideline.html">
            
                    
                    Guidelines
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../chapter-godevel/structure.html">
            
                <a href="../chapter-godevel/structure.html">
            
                    
                    Repository Structure
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../chapter-godevel/testing.html">
            
                <a href="../chapter-godevel/testing.html">
            
                    
                    Testing with mocks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../chapter-godevel/logging.html">
            
                <a href="../chapter-godevel/logging.html">
            
                    
                    Logging
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../chapter-godevel/instrumenting.html">
            
                <a href="../chapter-godevel/instrumenting.html">
            
                    
                    Instrumenting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../chapter-godevel/tracing.html">
            
                <a href="../chapter-godevel/tracing.html">
            
                    
                    Tracing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="../chapter-godevel/tracking.html">
            
                <a href="../chapter-godevel/tracking.html">
            
                    
                    Tracking
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8" data-path="../chapter-godevel/health_route.html">
            
                <a href="../chapter-godevel/health_route.html">
            
                    
                    Health routes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.9" data-path="../chapter-godevel/debugging.html">
            
                <a href="../chapter-godevel/debugging.html">
            
                    
                    Debugging
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.10" data-path="../chapter-godevel/middleware.html">
            
                <a href="../chapter-godevel/middleware.html">
            
                    
                    Middlewares
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Telepresence</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="connecting-to-an-existing-cluster-for-devs">Connecting to an existing cluster for devs</h1>
<p>When trying to develop a new service, it makes sense to try to connect it as if it were part of an existing cluster. But this requires rebuilding a docker image, writing a template file and creating the deployment, possibly disrupting the cluster and breaking everything.</p>
<p>To solve this issue, we invite you to look into <em>telepresence</em> (<a href="https://github.com/datawire/telepresence" target="_blank">https://github.com/datawire/telepresence</a>).
Telepresence works by creating well crafted iptables rules, tied to a shell. Those rules will detect the cluster IP range and redirect every request sent to that range to a proxy that is instantiated cluster-side.
For DNS, the approach is to forward all dns requests back to the proxy, which will try to resolve them against the cluster dns. If it fails, it will instruct the client to redirect to one of the regular DNS.</p>
<blockquote class="clearfix alert alert-warning"><strong class="fa fa-2x fa-exclamation-triangle"></strong>
<p> Although telepresence can run docker images with the adjusted network, docker&apos;s <code>--init</code> argument is passed by default to the starting container. This creates a process before our entrypoint and gives it PID 1. Since our containers run PID 1, systemd fails to start and the container just hangs. To solve this issue, we must pass <code>--init=false</code> as an argument to telepresence when running. Doing so however is NOT guaranteed to work, as this essentially results in a call like <code>docker run --init ... --init=false ...</code>, which could fail depending on docker versions. Discussions are ongoing with datawire to change this behaviour.</p>
</blockquote>
<h2 id="how-to-configure-to-connect-to-the-cluster">How to configure to connect to the cluster</h2>
<p>Telepresence expects being able to call kubectl, for that to happen, the correct kubeconfig file needs to be passed to kubectl. Once this is done we can run <code>telepresence --run-shell</code> to get a shell &quot;in the cluster&quot;.</p>
<p>With this shell, we can access cluster resources easily by using their Service names.
Some quick kubectl commands to get you running:</p>
<p><code>kubectl get --all-namespaces svc</code> &lt;- this will show all services running in all namespaces. The DNS exposes each services as &quot;service_name.namespace.svc.cluster_name&quot; so if I want to access the service &quot;postgresql&quot; in the default namespace, I can run <code>nslookup postgresql.default.svc.cloudtrust</code>. The dns will by default try the domains &quot;default.svc.cloudtrust, svc.cloudtrust, and .cloudtrust&quot; so this means we can also run <code>nslookup postgresql</code> to get the same result.
However, for services in another namespace, such as the dns itself, we need <code>nslookup kube-dns.kube-addons</code>.</p>
<p>To check the state of running deployments/pods, you can run <code>kubectl get deployments</code> or <code>kubectl get po</code>. For more information, there is also the <code>kubectl describe po</code> command (also works with deployments). If something seems wrong inside the cluster, <code>kubectl exec $POD_NAME</code> functions like a docker exec call, with similar options.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="Configs.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page: Configurations">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Telepresence","level":"1.3.7","depth":2,"next":{"title":"Go Development","level":"1.4","depth":1,"ref":"","articles":[{"title":"Guidelines","level":"1.4.1","depth":2,"path":"chapter-godevel/guideline.md","ref":"chapter-godevel/guideline.md","articles":[]},{"title":"Repository Structure","level":"1.4.2","depth":2,"path":"chapter-godevel/structure.md","ref":"chapter-godevel/structure.md","articles":[]},{"title":"Testing with mocks","level":"1.4.3","depth":2,"path":"chapter-godevel/testing.md","ref":"chapter-godevel/testing.md","articles":[]},{"title":"Logging","level":"1.4.4","depth":2,"path":"chapter-godevel/logging.md","ref":"chapter-godevel/logging.md","articles":[]},{"title":"Instrumenting","level":"1.4.5","depth":2,"path":"chapter-godevel/instrumenting.md","ref":"chapter-godevel/instrumenting.md","articles":[]},{"title":"Tracing","level":"1.4.6","depth":2,"path":"chapter-godevel/tracing.md","ref":"chapter-godevel/tracing.md","articles":[]},{"title":"Tracking","level":"1.4.7","depth":2,"path":"chapter-godevel/tracking.md","ref":"chapter-godevel/tracking.md","articles":[]},{"title":"Health routes","level":"1.4.8","depth":2,"path":"chapter-godevel/health_route.md","ref":"chapter-godevel/health_route.md","articles":[]},{"title":"Debugging","level":"1.4.9","depth":2,"path":"chapter-godevel/debugging.md","ref":"chapter-godevel/debugging.md","articles":[]},{"title":"Middlewares","level":"1.4.10","depth":2,"path":"chapter-godevel/middleware.md","ref":"chapter-godevel/middleware.md","articles":[]}]},"previous":{"title":"Configurations","level":"1.3.6","depth":2,"path":"chapter-deploy/Configs.md","ref":"chapter-deploy/Configs.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["richquotes"],"pluginsConfig":{"richquotes":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"chapter-deploy/Telepresence.md","mtime":"2018-03-06T08:09:26.297Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-04-03T13:03:13.889Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

